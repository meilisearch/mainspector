(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{485:function(e,t,a){"use strict";a.r(t);var n=a(62),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"swap-indexes-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#swap-indexes-api"}},[e._v("#")]),e._v(" Swap Indexes API")]),e._v(" "),a("h2",{attrs:{id:"_1-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-summary"}},[e._v("#")]),e._v(" 1. Summary")]),e._v(" "),a("p",[e._v("The swap indexes API allows to atomically deploy several new versions of indexes without any downtime for the search clients.")]),e._v(" "),a("h2",{attrs:{id:"_2-motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-motivation"}},[e._v("#")]),e._v(" 2. Motivation")]),e._v(" "),a("p",[e._v("It's critical to deploy a new version of an index without any downtimes to the search clients. This capability improves the development experience by allowing Meilisearch to better fit into their workflow.")]),e._v(" "),a("h2",{attrs:{id:"_3-functional-specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-functional-specification"}},[e._v("#")]),e._v(" 3. Functional Specification")]),e._v(" "),a("h3",{attrs:{id:"_3-1-0-downtime-deployment-workflow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-0-downtime-deployment-workflow"}},[e._v("#")]),e._v(" 3.1. 0 downtime deployment workflow")]),e._v(" "),a("p",[e._v("A 0 downtime deployment looks like this:")]),e._v(" "),a("ol",[a("li",[e._v("Search clients search on "),a("code",[e._v("indexA")]),e._v(".")]),e._v(" "),a("li",[e._v("The developer builds a new index "),a("code",[e._v("indexB")]),e._v(" representing the new index version to deploy to the search clients.")]),e._v(" "),a("li",[e._v("When "),a("code",[e._v("indexB")]),e._v(" is built and ready to be deployed, the developer sends an indexes swap request to Meilisearch for "),a("code",[e._v("indexA")]),e._v(" and "),a("code",[e._v("indexB")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("indexB")]),e._v(" documents, settings and tasks are swapped with "),a("code",[e._v("indexA")]),e._v(".")]),e._v(" "),a("li",[e._v("Search clients search on the updated "),a("code",[e._v("indexA")]),e._v(" without experiencing any downtime.")])]),e._v(" "),a("h3",{attrs:{id:"_3-2-deploying-multiple-new-indexes-versions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-deploying-multiple-new-indexes-versions"}},[e._v("#")]),e._v(" 3.2. Deploying Multiple New Indexes Versions")]),e._v(" "),a("p",[e._v("The swap API supports multiple swap operations in an atomic fashion.")]),e._v(" "),a("p",[e._v("This means that for a search experience built using multiple indexes, Meilisearch is able to deploy all changes at once and thus clients will access the new version of all indexes at once without any downtime.")]),e._v(" "),a("p",[e._v("There is no need to deploy each new version of indexes one by one.")]),e._v(" "),a("h3",{attrs:{id:"_3-3-enqueued-tasks-after-a-swap-operation-creation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-enqueued-tasks-after-a-swap-operation-creation"}},[e._v("#")]),e._v(" 3.3. Enqueued Tasks After A Swap Operation Creation")]),e._v(" "),a("p",[e._v("Tasks enqueued after an "),a("code",[e._v("indexSwap")]),e._v(" task creation date do not have their "),a("code",[e._v("indexUid")]),e._v(" modified when the "),a("code",[e._v("indexSwap")]),e._v(" will succeed. That is, if they are enqueued on "),a("code",[e._v("indexA")]),e._v(", they will run on the new version of "),a("code",[e._v("indexA")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"_3-4-api-endpoints-definition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-api-endpoints-definition"}},[e._v("#")]),e._v(" 3.4. API Endpoints Definition")]),e._v(" "),a("h4",{attrs:{id:"_3-4-1-post-swap-indexes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-post-swap-indexes"}},[e._v("#")]),e._v(" 3.4.1. "),a("code",[e._v("POST")]),e._v(" - "),a("code",[e._v("/swap-indexes")])]),e._v(" "),a("p",[e._v("Send one or many indexes swap operation at once.")]),e._v(" "),a("h5",{attrs:{id:"_3-4-1-1-payload-definition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-1-payload-definition"}},[e._v("#")]),e._v(" 3.4.1.1. Payload definition")]),e._v(" "),a("p",[e._v("The payload body expects an array of JSON objects representing swap operations.")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"indexes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"indexA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"indexA_new"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"indexes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"indexB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"indexB_new"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),a("p",[e._v("ðŸ’¡ In the given example, two swap operations will occur at the same time and atomically.")]),e._v(" "),a("p",[a("code",[e._v("indexA")]),e._v(" data will be swapped with "),a("code",[e._v("indexA_new")]),e._v(" data while "),a("code",[e._v("indexB")]),e._v(" data will be swapped with "),a("code",[e._v("indexB_new")]),e._v(" data.")]),e._v(" "),a("blockquote",[a("p",[e._v("Sending "),a("code",[e._v("[]")]),e._v(" is considered valid. No swap transactions will be performed.")])]),e._v(" "),a("h6",{attrs:{id:"swap-object-definition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#swap-object-definition"}},[e._v("#")]),e._v(" Swap Object Definition")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Field")]),e._v(" "),a("th",[e._v("Type")]),e._v(" "),a("th",[e._v("Required")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("a",{attrs:{href:"#33111-indexes"}},[e._v("indexes")])]),e._v(" "),a("td",[e._v("Array of string representing indexUids")]),e._v(" "),a("td",[e._v("True")])])])]),e._v(" "),a("h6",{attrs:{id:"_3-4-1-1-1-indexes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-1-1-indexes"}},[e._v("#")]),e._v(" 3.4.1.1.1. "),a("code",[e._v("indexes")])]),e._v(" "),a("ul",[a("li",[e._v("Type: Array of string")]),e._v(" "),a("li",[e._v("Required: True")])]),e._v(" "),a("p",[e._v("Determines which two indexes should exchange their data for their given swap object.")]),e._v(" "),a("h5",{attrs:{id:"_3-4-1-2-response-definition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-2-response-definition"}},[e._v("#")]),e._v(" 3.4.1.2. Response Definition")]),e._v(" "),a("p",[e._v("When the request is in a successful state, Meilisearch returns the HTTP code "),a("code",[e._v("202 Accepted")]),e._v(". The response's content is the summarized representation of the received asynchronous task.")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"taskUid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"indexUid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[e._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"enqueued"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"indexSwap"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"enqueuedAt"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2021-08-12T10:00:00.000000Z"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("blockquote",[a("p",[e._v("An "),a("code",[e._v("indexSwap")]),e._v(" task is considered a global task; thus "),a("code",[e._v("indexUid")]),e._v(" is null.")])]),e._v(" "),a("p",[e._v("See "),a("RouterLink",{attrs:{to:"/specifications/text/0060-tasks-api.html#summarized-task-object-for-202-accepted"}},[e._v("Summarized "),a("code",[e._v("task")]),e._v(" Object for "),a("code",[e._v("202 Accepted")])]),e._v(".")],1),e._v(" "),a("h5",{attrs:{id:"_3-4-1-3-errors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-3-errors"}},[e._v("#")]),e._v(" 3.4.1.3. Errors")]),e._v(" "),a("h6",{attrs:{id:"_3-4-1-3-1-synchronous-errors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-3-1-synchronous-errors"}},[e._v("#")]),e._v(" 3.4.1.3.1. Synchronous Errors")]),e._v(" "),a("ul",[a("li",[e._v("ðŸ”´ If the instance is secured by a master key, accessing this route without the "),a("code",[e._v("Authorization")]),e._v(" header returns a "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#missing_authorization_header"}},[e._v("missing_authorization_header")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ If the instance is secured by a master key, accessing this route with a key that does not have permissions (missing "),a("code",[e._v("indexes.swap")]),e._v(" action or having a value for the "),a("code",[e._v("indexes")]),e._v(" field of a swap operation not being defined in the API Key "),a("code",[e._v("indexes")]),e._v(" array) (i.e. other than the master key) returns anÂ "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_api_key"}},[e._v("invalid_api_key")]),e._v("Â error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Omitting Content-Type header returns a "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#missing_content_type"}},[e._v("missing_content_type")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Sending an empty Content-Type returns an "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_content_type"}},[e._v("invalid_content_type")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Sending a different Content-Type than "),a("code",[e._v("application/json")]),e._v(" returns an "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_content_type"}},[e._v("invalid_content_type")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Sending an empty payload returns a "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#missing_payload"}},[e._v("missing_payload")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Sending an invalid JSON payload returns a "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#malformed_payload"}},[e._v("malformed_payload")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Omitting the "),a("code",[e._v("indexes")]),e._v(" array in a swap payload returns a "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#missing_swap_indexes"}},[e._v("missing_swap_indexes")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Sending an "),a("code",[e._v("indexes")]),e._v(" array containing an invalid index uid format returns an "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_swap_indexes"}},[e._v("invalid_swap_indexes")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Sending an "),a("code",[e._v("indexes")]),e._v(" array not containing "),a("strong",[e._v("exactly")]),e._v(" 2 indexUids for a swap operation object returns a "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_swap_indexes"}},[e._v("invalid_swap_indexes")]),e._v(" error.")],1),e._v(" "),a("li",[e._v("ðŸ”´ Sending an indexUid more than once in the request payload returns a "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_swap_duplicate_index_found"}},[e._v("invalid_swap_duplicate_index_found")]),e._v(" error.")],1)]),e._v(" "),a("h6",{attrs:{id:"_3-4-1-3-2-asynchronous-errors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-3-2-asynchronous-errors"}},[e._v("#")]),e._v(" 3.4.1.3.2. Asynchronous Errors")]),e._v(" "),a("ul",[a("li",[e._v("ðŸ”´ Sending indexUids that do not exist within the "),a("code",[e._v("indexes")]),e._v(" field of a swap operation returns an "),a("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#index_not_found"}},[e._v("index_not_found")]),e._v(" error.")],1)]),e._v(" "),a("h2",{attrs:{id:"_4-technical-details"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-technical-details"}},[e._v("#")]),e._v(" 4. Technical Details")]),e._v(" "),a("h3",{attrs:{id:"_4-1-swapping-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-swapping-data"}},[e._v("#")]),e._v(" 4.1. Swapping Data")]),e._v(" "),a("p",[e._v("When indexes are swapped their data is exchanged. It concerns:")]),e._v(" "),a("ul",[a("li",[e._v("The documents")]),e._v(" "),a("li",[e._v("The settings")]),e._v(" "),a("li",[e._v("The tasks history\n"),a("ul",[a("li",[e._v("An index swap between index_a and index_b will also replace every mention of index_a by index_b (and vice-versa) in the task history. Enqueued tasks are left unmodified.")])])])]),e._v(" "),a("h2",{attrs:{id:"_5-future-possibilities"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-future-possibilities"}},[e._v("#")]),e._v(" 5. Future Possibilities")]),e._v(" "),a("ul",[a("li",[e._v("Introduce a way to delete one of the swapped indexes when the swap operation occurs.")])])])}),[],!1,null,null,null);t.default=s.exports}}]);